# HUGANJOB配信停止管理システム 使用ガイド

**作成日時**: 2025年06月24日  
**バージョン**: 1.0  
**対象システム**: HUGANJOBメール営業システム

---

## 📋 システム概要

HUGANJOB配信停止管理システムは、Googleフォームからの配信停止申請を自動処理し、企業データベースを更新するシステムです。配信停止済み企業への誤送信を防止し、コンプライアンスを確保します。

### 主要機能
- **配信停止申請の自動処理**
- **企業データベースとの照合・更新**
- **送信システムでの配信停止チェック**
- **ダッシュボードでの配信停止状況管理**

---

## 🔧 システム構成

### 1. 配信停止管理スクリプト
- **ファイル**: `huganjob_unsubscribe_manager.py`
- **役割**: 配信停止申請の処理とデータベース更新

### 2. ダッシュボード機能
- **URL**: `http://127.0.0.1:5002/unsubscribe-management`
- **役割**: 配信停止状況の可視化と管理

### 3. 送信システム統合
- **ファイル**: `huganjob_unified_sender.py`
- **役割**: 送信前の配信停止チェック

### 4. データファイル
- **配信停止ログ**: `data/huganjob_unsubscribe_log.csv`
- **企業データベース**: `data/new_input_test.csv`

---

## 🚀 基本操作

### 配信停止処理の実行

```bash
# 基本的な配信停止処理
python huganjob_unsubscribe_manager.py --process

# 特定メールアドレスの配信停止状況確認
python huganjob_unsubscribe_manager.py --check-email info@example.com

# 配信停止済み企業一覧表示
python huganjob_unsubscribe_manager.py --list-unsubscribed

# 送信システム用配信停止リスト出力
python huganjob_unsubscribe_manager.py --export-list
```

### ダッシュボードでの管理

1. **ダッシュボード起動**
   ```bash
   python dashboard/derivative_dashboard.py
   ```

2. **配信停止管理ページアクセス**
   - URL: `http://127.0.0.1:5002/unsubscribe-management`

3. **主要機能**
   - 配信停止処理の実行
   - 配信停止状況の確認
   - 統計情報の表示

---

## 📊 現在の配信停止状況

### 処理済み配信停止申請（5件）

| 企業ID | 企業名 | メールアドレス | 配信停止日時 |
|--------|--------|----------------|--------------|
| 792 | 株式会社キーマン | info@keyman.co.jp | 2025-06-24 18:11:33 |
| 576 | 日建株式会社 | saiyo@nikken-r.co.jp | 2025-06-24 18:11:33 |
| 1003 | エーワイマシンサービス株式会社 | info@ams-inc.co.jp | 2025-06-24 18:11:33 |
| 996 | オムニヨシダ株式会社 | info@omni-yoshida.co.jp | 2025-06-24 18:11:33 |
| 1311 | 株式会社Growship | info@grow-ship.com | 2025-06-24 18:11:33 |

### 統計情報
- **総企業数**: 1,859社
- **配信停止企業数**: 5社
- **配信停止率**: 0.27%
- **配信可能企業数**: 1,854社

---

## 🔄 配信停止処理フロー

### 1. 配信停止申請の受付
- **Googleフォーム**: `https://forms.gle/49BTNfSgUeNkH7rz5`
- **手動確認**: 引き継ぎ書やメール確認による申請特定

### 2. 企業データベースとの照合
- メールアドレスによる直接照合
- ドメインベースでの企業特定

### 3. 配信停止状態の更新
- 配信停止ログへの記録
- 企業データベースの更新
- バックアップファイルの作成

### 4. 送信システムでの自動チェック
- 送信前の配信停止状況確認
- 配信停止済み企業への送信ブロック

---

## 🛡️ 送信システムでの配信停止チェック

### 統合送信システムでの動作

```bash
# 配信停止済み企業への送信テスト
python huganjob_unified_sender.py --start-id 792 --end-id 792
```

**実行結果例**:
```
📤 送信準備: 株式会社キーマン
   📧 宛先: info@keyman.co.jp
   💼 職種: 施工管理職
   🚫 配信停止済み: 手動確認による配信停止申請 - スキップします

📊 統合メール送信結果
🛑 配信停止: 1/1 (配信停止申請)
```

### チェック優先順位
1. **配信停止チェック**（最優先）
2. 重複送信チェック
3. バウンス履歴チェック
4. メール送信実行

---

## 📁 データファイル構造

### 配信停止ログ（huganjob_unsubscribe_log.csv）
```csv
企業ID,企業名,メールアドレス,配信停止日時,配信停止理由,申請元,処理状況
792,株式会社キーマン,info@keyman.co.jp,2025-06-24 18:11:33,手動確認による配信停止申請,manual_verification,完了
```

### 企業データベース更新
- 新しい列が追加されます：
  - `配信停止状態`
  - `配信停止日時`
  - `配信停止理由`

---

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. 配信停止処理が失敗する
```bash
# データファイルの権限確認
ls -la data/huganjob_unsubscribe_log.csv
ls -la data/new_input_test.csv

# 手動でディレクトリ作成
mkdir -p data
mkdir -p logs
```

#### 2. 企業が見つからない
- メールアドレスの正確性を確認
- ドメイン名の一致を確認
- 企業データベースの最新性を確認

#### 3. ダッシュボードでエラーが発生
```bash
# ダッシュボード再起動
python dashboard/derivative_dashboard.py
```

---

## 📈 今後の拡張予定

### 1. Googleフォーム自動連携
- Google Forms APIとの連携
- リアルタイム配信停止処理

### 2. 配信停止理由の詳細化
- 理由別の統計分析
- 改善提案の自動生成

### 3. 通知機能
- 配信停止申請の即座通知
- 定期的な統計レポート

---

## 🔒 セキュリティ・コンプライアンス

### データ保護
- 配信停止申請の完全記録
- バックアップファイルの自動作成
- 処理履歴の監査証跡

### 法的対応
- 配信停止申請の即座対応
- 再送信防止の確実な実装
- GDPR等の規制への準拠

---

## 📞 サポート・連絡先

### 緊急時対応
1. **配信停止処理の即座実行**
   ```bash
   python huganjob_unsubscribe_manager.py --process
   ```

2. **送信システムの停止**
   - 実行中のプロセスを停止
   - 配信停止処理を実行後に再開

### 技術サポート
- システム仕様: `HUGANJOB_CORE_SYSTEM_SPECIFICATIONS.md`
- 引き継ぎ書: `HUGANJOB_HANDOVER_20250624_174800.md`

---

**最終更新**: 2025年06月24日 18:15:00  
**次回レビュー**: 配信停止申請発生時または月次レビュー時
