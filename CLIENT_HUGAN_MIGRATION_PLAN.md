# client@hugan.co.jp 段階的移行計画書

**作成日時**: 2025年6月19日  
**目的**: marketing@fortyfive.co.jpからclient@hugan.co.jpへの完全移行  
**期間**: 2-3週間（DNS反映期間含む）

---

## 移行概要

### 🎯 **移行目標**
- client@hugan.co.jpでの完全なSMTP認証
- SPF/DKIM認証の正常通過
- 迷惑メール判定の完全回避
- ブランド統一の実現

### 📊 **現状 vs 目標**

| 項目 | 現状 | 目標 |
|------|------|------|
| **認証アドレス** | marketing@fortyfive.co.jp | client@hugan.co.jp |
| **表示アドレス** | client@hugan.co.jp | client@hugan.co.jp |
| **ドメイン一致** | ❌ 不一致 | ✅ 完全一致 |
| **迷惑メール判定** | ⚠️ 発生あり | ✅ 最小化 |
| **ブランド統一** | ⚠️ 部分的 | ✅ 完全統一 |

---

## Phase 1: 準備・調査段階（1-2日）

### 🔍 **現状調査**

#### ステップ1.1: ドメイン調査
```bash
# DNS設定の現状確認
python domain_investigation_tool.py
```

#### ステップ1.2: 必要な設定の特定
- [ ] SPFレコードの確認
- [ ] MXレコードの確認
- [ ] DKIMレコードの確認
- [ ] 現在のDNS設定のバックアップ

#### ステップ1.3: リスク評価
- DNS設定変更のリスク評価
- メール送信停止のリスク評価
- ロールバック計画の策定

### 📋 **成果物**
- [ ] ドメイン調査レポート
- [ ] DNS設定変更計画
- [ ] リスク評価書
- [ ] ロールバック手順書

---

## Phase 2: DNS設定実装段階（3-5日）

### 🔧 **DNS設定変更**

#### ステップ2.1: SPFレコード設定
```
レコード: hugan.co.jp. IN TXT "v=spf1 include:_spf.sakura.ne.jp ~all"
目的: sakura.ne.jp経由送信の許可
```

#### ステップ2.2: MXレコード設定
```
レコード: hugan.co.jp. IN MX 10 f045.sakura.ne.jp.
目的: メール受信サーバーの指定
```

#### ステップ2.3: DKIMレコード設定
```
レコード: default._domainkey.hugan.co.jp. IN TXT "v=DKIM1; k=rsa; p=[公開鍵]"
目的: デジタル署名の設定
```

### ⏰ **反映確認**
- DNS設定反映の監視（1-4時間）
- 各レコードの動作確認
- 外部DNSサーバーでの確認

### 📋 **成果物**
- [ ] DNS設定完了確認書
- [ ] 反映状況レポート
- [ ] 動作確認結果

---

## Phase 3: メールアカウント作成段階（1日）

### 👤 **sakura.ne.jpでのアカウント作成**

#### ステップ3.1: コントロールパネルアクセス
- sakura.ne.jpコントロールパネルログイン
- メール設定画面へのアクセス

#### ステップ3.2: アカウント作成
```
メールアドレス: client@hugan.co.jp
パスワード: [強力なパスワード]
容量: 1GB以上
SMTP認証: 有効
```

#### ステップ3.3: DKIM設定
- HUGAN.co.jpドメイン用DKIM鍵生成
- 公開鍵のDNSレコード設定
- DKIM署名の有効化

### 📋 **成果物**
- [ ] メールアカウント作成完了
- [ ] SMTP認証情報
- [ ] DKIM設定完了確認

---

## Phase 4: テスト段階（2-3日）

### 🧪 **段階的テスト実行**

#### ステップ4.1: 設定ファイル作成
```bash
# client@hugan.co.jp用設定作成
python create_client_hugan_config.py
```

#### ステップ4.2: SMTP接続テスト
```bash
# 接続・認証テスト
python client_hugan_smtp_test.py
```

#### ステップ4.3: 送信テスト
- 3つのテストアドレスへの送信
- 受信確認（迷惑メール判定チェック）
- HTMLメール表示確認

#### ステップ4.4: 認証確認
- SPF認証の確認
- DKIM認証の確認
- 送信者表示の確認

### 📊 **テスト項目**

| テスト項目 | 期待結果 | 確認方法 |
|------------|----------|----------|
| SMTP認証 | 成功 | 接続テスト |
| SPF認証 | PASS | メールヘッダー確認 |
| DKIM認証 | PASS | メールヘッダー確認 |
| 迷惑メール判定 | 回避 | 受信トレイ確認 |
| 送信者表示 | client@hugan.co.jp | メールクライアント確認 |

### 📋 **成果物**
- [ ] テスト結果レポート
- [ ] 認証確認書
- [ ] 受信確認書

---

## Phase 5: 本格移行段階（1日）

### 🚀 **システム設定切り替え**

#### ステップ5.1: 設定ファイル切り替え
```bash
# バックアップ作成
cp config/derivative_email_config.ini config/derivative_email_config_backup.ini

# 新設定に切り替え
cp config/client_hugan_email_config.ini config/derivative_email_config.ini
```

#### ステップ5.2: システム再起動
```bash
# ダッシュボード再起動
python dashboard/derivative_dashboard.py --port 5002
```

#### ステップ5.3: 本格送信テスト
```bash
# 1社のみテスト送信
python core_scripts/derivative_ad_email_sender.py --start-id 1 --end-id 1

# 全社送信（確認後）
python core_scripts/derivative_ad_email_sender.py --start-id 1 --end-id 9
```

### 📋 **成果物**
- [ ] 設定切り替え完了
- [ ] 本格送信テスト結果
- [ ] 移行完了確認書

---

## Phase 6: 監視・最適化段階（1週間）

### 📊 **効果測定**

#### 監視項目
- 送信成功率
- 迷惑メール判定率
- 開封率
- 返信率
- エラー発生率

#### 最適化項目
- 送信間隔の調整
- 件名の最適化
- 内容の調整
- 送信タイミングの最適化

### 📋 **成果物**
- [ ] 効果測定レポート
- [ ] 最適化提案書
- [ ] 運用手順書

---

## リスク管理

### ⚠️ **潜在的リスク**

#### 1. DNS設定ミス
- **影響**: メール受信不可
- **対策**: 設定前バックアップ
- **復旧**: 元設定への即座復旧

#### 2. SMTP認証失敗
- **影響**: メール送信不可
- **対策**: 段階的テスト
- **復旧**: 旧設定への切り戻し

#### 3. 迷惑メール判定増加
- **影響**: 配信率低下
- **対策**: 内容・頻度調整
- **復旧**: 設定の微調整

### 🛡️ **緊急時対応**

#### 即座復旧手順
```bash
# 緊急時：旧設定に戻す
cp config/derivative_email_config_backup.ini config/derivative_email_config.ini

# システム再起動
python dashboard/derivative_dashboard.py --port 5002
```

---

## 成功指標

### 📈 **KPI設定**

| 指標 | 現状 | 目標 | 測定方法 |
|------|------|------|----------|
| 送信成功率 | 95% | 98%以上 | ログ分析 |
| 迷惑メール判定率 | 30% | 5%以下 | 受信確認 |
| 開封率 | 10% | 15%以上 | トラッキング |
| 返信率 | 1% | 2%以上 | 返信数カウント |

### ✅ **完了条件**
- [ ] 全テストの成功
- [ ] 迷惑メール判定率5%以下
- [ ] 送信成功率98%以上
- [ ] 1週間の安定運用

---

## タイムライン

### 📅 **実行スケジュール**

```
Week 1:
  Day 1-2: Phase 1 (準備・調査)
  Day 3-5: Phase 2 (DNS設定)
  Day 6-7: Phase 3 (アカウント作成)

Week 2:
  Day 1-3: Phase 4 (テスト)
  Day 4: Phase 5 (本格移行)
  Day 5-7: Phase 6 (監視開始)

Week 3:
  Day 1-7: Phase 6 (継続監視・最適化)
```

### 🎯 **マイルストーン**
- [ ] DNS設定完了（Day 5）
- [ ] アカウント作成完了（Day 7）
- [ ] テスト完了（Day 10）
- [ ] 本格移行完了（Day 11）
- [ ] 安定運用確認（Day 18）

---

**重要**: 各フェーズで問題が発生した場合は、即座に前のフェーズに戻り、問題解決後に再開してください。安全性を最優先に移行を進めることが重要です。
